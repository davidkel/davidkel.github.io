### [TOC](./TOC.md)

### [Back - Network Admin participant type](./networkadmin.md)

# Fabric CA
In order to interact with a fabric network you need public certificates which are chained to the MSP your organisation is using. You could use a 3rd party certificate provider and there are loads out there or you could host your own certificate authority. Hyperledger Fabric provide the `Fabric Certificate Authority` capability in the form of a server, a Client CLI as well as support in the node-sdk to be able to interact with the server. Hyperledger Composer also interacts with the Fabric CA Server when required, but it is perfectly possible to use Hyperledger Composer without it ever communicating with the Fabric CA Server. All you do is always work with certificates (more on this later)

The Fabric CA Server accepts many different type of commands, for example

- register: to register a new identity with a common name
- enroll: enroll that identity by generating a certificate from a CSR (Certificate Signing Request) which in itself is generated from a private key. The certificate created will have a Common Name set to the value supplied on registration

## Registration
Registration is where you tell the Fabric CA Server of a new user that you want it to manage. So long as the requester has `issuer` authority then this registration will be stored and a _secret_ is autogenerated returned to the requester. That _secret_ is then used by the user to enroll. A requester can also request whether that new user will also have issuer authority, ie allow that new user to also be able to register new users on the fabric ca server. The final thing they can do is specify how many times that user can be enrolled. Once that limit has been reached, that user can never be enrolled again and you get the cryptic message `Authorization Failure` if you attempt to do so. You can only determine this was the problem by looking at the fabric ca server logs.

## Enroll
Enrollment is the process of taking a user and secret, generating a CSR from a provided private key and sending the CSR along with the user and secret to the fabric ca server. The fabric CA Server checks the user and secret, ensures that the user can be enrolled and that the enrollment limit has not been reached and then returns an appropriate public certificate to the caller. It also increments the enrollment count for that user.

### important point about enrollment
If a user can be enrolled more than once, be aware that the certificate returned on each enrollment is different, you DON'T get the same certificate and as such each certificate represents a DIFFERENT identity. For example if you enroll an identity called `admin` twice, you get 2 certificates, both have a common name of `admin` but they are NOT the same identity. They just have the same name. As an analogy, 2 people can be called `Dave` but they aren't the same person.

## Bootstrap identity
The Fabric CA Server must define a bootstrap identity. This is the identity that allows you as an administrator to register new identities to the server, ie it has `issuer` authority. Without this the server would be pretty useless. You define the name and a secret for this identity (basically it is pre-registered for you) as part of the configuration of your Fabric CA Server. In the example fabric network provided by Hyperledger Composer, this bootstrap identity is configured to be `admin` with a secret of `adminpw`. It's done on the launching of the fabric CA Server as follows

```
fabric-ca-server start --ca.certfile /etc/hyperledger/fabric-ca-server-config/ca.org1.example.com-cert.pem --ca.keyfile /etc/hyperledger/fabric-ca-server-config/key.pem -b admin:adminpw -d
```

but it can also be configured on the server's configuration yaml file.
By default the enrollment count for this bootstrap identity is infinite.

## How Hyperledger Composer makes use of the fabric CA Server.
If you provide a business network card that just contains a secret, Hyperledger Composer will attempt to enroll that user defined in that card the first time it is ever used. Once it has the certificate and private key, it won't ever use the secret again.

Apart from the `composer card create` command and aside from Playground (not covered, see the introduction for more information) there are 2 commands that create business network cards for you.

### composer network start
This will create a business network card for you and you provide the information about the name and whether to provide a secret `-S` or a certificate `-C`. There is actually a problem with this command and unless you are using an _HSM_ to manage your private keys, then any card created using the `-C` option is unusable (as it won't have a private key). This is why a lot of the tutorials and examples use the `-S` option. More information about this command is in later sections.


## composer identity issue
This command does a register with the fabric ca server, so the card you choose to use must be an identity that has issuer authority on the fabric ca server. It will then create a business network card that has a secret in. This command will be discussed in more detail later.


### [Next - Deploying Business Networks](./deploy.md)
